# mpradesigntools
An R package for generating barcoded Massively Parallel Reporter Assay sequences

# Installation

## Dependencies
MPRA Design Tools depends on the Biostrings and BSgenome.Hsapiens.UCSC.hg38 packages from Bioconductor. First install these in R with the following commands:
```{r}
source("https://bioconductor.org/biocLite.R")
biocLite("Biostrings")
biocLite("BSgenome.Hsapiens.UCSC.hg38")
```

The package also makes use of some tidyverse packages which can be installed with the following commands:
```{r}
install.packages(c('dplyr', 'magrittr', 'purrr', 'readr', 'stringr', 'tibble', 'tidyr', 'purrrlyr'))
```

## Package Installation

If you don't have the devtools package installed, install it like so:
```{r}
install.packages("devtools")
```

After that you can install and load MPRA Design Tools with these commands:

```{r}
devtools::install_github('andrewGhazi/mpradesigntools')
library(mpradesigntools)
```

# Use

This is the companion package to the MPRA Design Tools Shiny application available here: https://andrewghazi.shinyapps.io/designmpra/

The Shiny app allows users to interact with MPRA parameters (such as number of barcodes per allele) and see the effect of changing parameters on the assays power. Researchers can use this to decide what parameters best meet their experimental goals.

Currently the main function of MPRA Design Tools package is to design a set of barcoded sequences for MPRA experiments (without overloading our Shiny server!). This is done with the `processVCF` function. It takes roughly 5 seconds + 10ms per barcoded sequence on a relatively modern CPU, so you can estimate the expected job time in seconds as 
```tex
5 + .01 * Number of barcodes per allele * Number of SNPs in VCF * 2 (for ref/alt alleles)
```

# VCF Input constraints

Only the CHROM, POS, REF, and ALT columns are used. The INFO column is used only for detecting reverse strand constructs.

Current input constraints are:

*   Barcodes are constrained to being 12bp in length
*   Insertions and deletions must encode the reference and alternate alleles (respectively) as a dash character '-'.
*   Multiple alternate alleles should be separated in the ALT field by a comma and no spaces
*   By default, the program pulls the sequence context from the forward (+) strand of the reference genome. If the user wishes to generate SNPs for genes that normally are read from the reverse strand, add a string containing "MPRAREV" to the INFO field of the VCF. This will ensure that the genomic context gets inserted with the correct orientation relative to the minimal promoter and barcode in the reporter plasmid.

VCFs generated by batch querying rsID's on dbSNP should meet most of the formatting requirements. However the MPRAREV tag will need to be added by the user (where appropriate) because the VCF's do not always specify which strand the relevant gene is on. 

## Example
```{r}
processVCF(inputVCF, barcodesPerAllele, upstreamContextRange, downstreamContextRange, fwdPrimer, reversePrimer, filterPatterns = "AATAAA", outPath = <somewhere>/output.tsv)
processVCF(<pathToVCF>, 5, 75, 75, 'ACTGGCCAG', 'CTCGGCGGCC', filterPatterns = "AATAAA", outPath = <somewhere>/output.tsv)
```
